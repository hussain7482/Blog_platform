<h1>All Posts</h1>

<% if user_signed_in? %>
  <!-- Logout Button -->
  <%= link_to 'Logout', destroy_user_session_path, method: :delete, class: 'btn btn-danger', data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' } %>

  <!-- New Post Button for Authors -->
  <% if current_user.role == "author" %>
    <%= link_to 'New Post', new_post_path, class: 'btn btn-primary' %>
  <% end %>

  <!-- Button to view unpublished posts for Authors and Editors -->
  <% if current_user.role == "author" %>
    <%= link_to 'View Unpublished Posts', unpublished_posts_path, class: 'btn btn-secondary' %>
  <% end %>

  <!-- Display Posts -->
  <% if @posts.any? %>
    <ul>
      <% @posts.each do |post| %>
        <li>
          <h2><%= link_to post.title, post %></h2>
          <% if post.image.attached? %>
          <%= image_tag post.image, alt: post.title, class: 'post-image' %>
          <% end %>
          <p><%= truncate(post.content, length: 100) %></p>

         
          <!-- Options for Editors -->
          <% if current_user.role == "editor" %>
            <% if post.status == "pending_approval" %>
              <!-- Comment Form for Approval and Rejection -->
              <div>
                <%= label_tag "comment_#{post.id}", 'Comment' %>
                <%= text_area_tag "comment_#{post.id}", nil, class: 'form-control', rows: 3, required: true %>
              </div>
              <div class="btn-group">
                <%= button_to 'Approve', approve_post_path(post), method: :put, params: { comment: params["comment_#{post.id}"] }, class: 'btn btn-success' %>
                <%= button_to 'Reject', reject_post_path(post), method: :put, params: { comment: params["comment_#{post.id}"] }, class: 'btn btn-danger' %>
              </div>
            <% elsif post.status == "approved" %>
              <%= link_to 'Request Revisions', request_revision_post_path(post), method: :put, class: 'btn btn-secondary' %>
            <% end %>
          <% end %>

          <!-- Options for Admins -->
          <% if current_user.role == "admin" %>
            <% if post.status == "approved" %>
              <%= link_to 'Publish', publish_post_path(post), method: :put, class: 'btn btn-primary', data: { turbo_method: :put } %>
            <% elsif post.status == "published" %>
              <%= link_to 'Archive', archive_post_path(post), method: :put, class: 'btn btn-danger' %>
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p>No posts available.</p>
  <% end %>

<% else %>
  <p>You must be logged in to view the posts.</p>
<% end %>
